products:
  - HG

bucket_config:
  enabled: true
  us_regular_hours:
    start: 9
    end: 15
    granularity: "hourly"
  off_peak_sessions:
    late_us:
      hours: [16, 17, 18, 19, 20]
      bucket: 8
      label: "Late US/After-Hours"
    asia:
      hours: [21, 22, 23, 0, 1, 2]
      bucket: 9
      label: "Asia Session"
    europe:
      hours: [3, 4, 5, 6, 7, 8]
      bucket: 10
      label: "Europe Session"

data:
  minute_root: "../organized_data/copper"  # Relative path - works on any machine
  timezone: "US/Central"
  price_field: "close"  # or "settle" if available

data_quality:
  filter_enabled: true          # Master switch for data filtering
  cutoff_year: 2015             # Exclude contracts expiring before this year
  min_data_points: 500          # Minimum required data points per contract (lowered from 1000)
  max_gap_days: 30              # Maximum acceptable gap in trading days
  min_coverage_percent: 25      # Minimum % of trading days with data (lowered from 30)
  trim_early_sparse: true       # Remove early sparse data from good contracts
  commodity: "HG"               # Currently filtering only HG contracts

roll_rules:
  fixed_days_before_expiry: 5
  liquidity_threshold: 0.8
  confirm_days: 1
  use_open_interest: false

# Label selection (expiry_v1 = legacy; expiry_v2 = deterministic UTC-based)
selection:
  mode: expiry_v1

time:
  tz_exchange: America/Chicago

strip_analysis:
  enabled: true
  strip_length: 12
  dominance_ratio_threshold: 2.0
  expiry_window_business_days: 18
  filter_expiry_dominance: true

spread:
  method: "zscore"           # Detection method: "zscore", "abs", or "combined"
  window_buckets: 20         # Rolling window in buckets (~2 days at 10 buckets/day)
  z_threshold: 1.5           # Z-score threshold (1.5 gives ~5% detection rate)
  abs_min: null              # Minimum absolute change (set to 0.020 to filter noise if needed)
  cool_down_hours: 3.0       # Time-based cool-down between events (hours)

business_days:
  enabled: false             # Master switch for business day calculations
  calendar_paths:            # List of calendar files (hierarchical override)
    - "../metadata/calendars/cme_globex_holidays.csv"
  calendar_hierarchy: "override"  # "override" | "union" | "intersection"
  min_total_buckets: 6       # Minimum total buckets per day for data guard
  min_us_buckets: 2          # Minimum US session buckets per day
  partial_day_min_buckets: 4 # Minimum buckets for partial trading days
  volume_threshold:
    method: "dynamic"        # "dynamic" | "fixed"
    fixed_percentile: 0.10   # Used when method="fixed"
    dynamic_ranges:          # Used when method="dynamic"
      - max_days: 5
        percentile: 0.30     # Delivery month (very near expiry)
      - max_days: 30
        percentile: 0.20     # Near expiry
      - max_days: 60
        percentile: 0.10     # Active roll period
      - max_days: 999
        percentile: 0.05     # Far contracts
  near_expiry_relax: 5       # Days to expiry for relaxed coverage requirements
  fallback_policy: "calendar_only"  # "calendar_only" | "union_with_data" | "intersection_strict"

output_dir: "../outputs"
